{"version":3,"names":["Server","loadConfig","globalsSchema","playerSchema","pluginPlatformInit","config","process","env","ENV","import","meta","url","console","log","app","name","pid","server","useDefaultApplicationTemplate","pluginManager","register","stateManager","registerSchema","globals","create","registerUpdateHook","updates","currentValues","context","filterSlider","filterFreq","sawFreq","numHarm","Math","floor","start"],"sources":["../../src/server/index.js"],"sourcesContent":["import '@soundworks/helpers/polyfills.js';\nimport { Server } from '@soundworks/core/server.js';\n\nimport { loadConfig } from '../utils/load-config.js';\nimport '../utils/catch-unhandled-errors.js';\nimport { globalsSchema } from './schemas/globals.js';\nimport { playerSchema } from './schemas/player.js';\nimport pluginPlatformInit from '@soundworks/plugin-platform-init/server.js';\n\n// - General documentation: https://soundworks.dev/\n// - API documentation:     https://soundworks.dev/api\n// - Issue Tracker:         https://github.com/collective-soundworks/soundworks/issues\n// - Wizard & Tools:        `npx soundworks`\n\nconst config = loadConfig(process.env.ENV, import.meta.url);\n\nconsole.log(`\n--------------------------------------------------------\n- launching \"${config.app.name}\" in \"${process.env.ENV || 'default'}\" environment\n- [pid: ${process.pid}]\n--------------------------------------------------------\n`);\n\n/**\n * Create the soundworks server\n */\nconst server = new Server(config);\n// configure the server for usage within this application template\nserver.useDefaultApplicationTemplate();\n\nserver.pluginManager.register('platform-init', pluginPlatformInit);\n\nserver.stateManager.registerSchema('globals', globalsSchema);\nserver.stateManager.registerSchema('player', playerSchema);\n\nconst globals = await server.stateManager.create('globals');\n\nserver.stateManager.registerUpdateHook('player', (updates, currentValues, context) => {\n  if (updates.filterSlider) {\n    const filterFreq = 1 + (updates.filterSlider * currentValues.sawFreq * 7);\n    const numHarm = Math.floor(filterFreq / currentValues.sawFreq);\n    return {\n      ...updates,\n      filterFreq: filterFreq,\n      numHarm: numHarm,\n    }\n  } else {\n    return {\n      ...updates\n    };\n  }\n});\n\n/**\n * Register plugins and schemas\n */\n// server.pluginManager.register('my-plugin', plugin);\n// server.stateManager.registerSchema('my-schema', definition);\n\n/**\n * Launch application (init plugins, http server, etc.)\n */\nawait server.start();\n\n// and do your own stuff!\n\n"],"mappings":"AAAA,OAAO,kCAAkC;AACzC,SAASA,MAAM,QAAQ,4BAA4B;AAEnD,SAASC,UAAU,QAAQ,yBAAyB;AACpD,OAAO,oCAAoC;AAC3C,SAASC,aAAa,QAAQ,sBAAsB;AACpD,SAASC,YAAY,QAAQ,qBAAqB;AAClD,OAAOC,kBAAkB,MAAM,4CAA4C;;AAE3E;AACA;AACA;AACA;;AAEA,MAAMC,MAAM,GAAGJ,UAAU,CAACK,OAAO,CAACC,GAAG,CAACC,GAAG,EAAEC,MAAM,CAACC,IAAI,CAACC,GAAG,CAAC;AAE3DC,OAAO,CAACC,GAAG,CAAE;AACb;AACA,eAAeR,MAAM,CAACS,GAAG,CAACC,IAAK,SAAQT,OAAO,CAACC,GAAG,CAACC,GAAG,IAAI,SAAU;AACpE,UAAUF,OAAO,CAACU,GAAI;AACtB;AACA,CAAC,CAAC;;AAEF;AACA;AACA;AACA,MAAMC,MAAM,GAAG,IAAIjB,MAAM,CAACK,MAAM,CAAC;AACjC;AACAY,MAAM,CAACC,6BAA6B,CAAC,CAAC;AAEtCD,MAAM,CAACE,aAAa,CAACC,QAAQ,CAAC,eAAe,EAAEhB,kBAAkB,CAAC;AAElEa,MAAM,CAACI,YAAY,CAACC,cAAc,CAAC,SAAS,EAAEpB,aAAa,CAAC;AAC5De,MAAM,CAACI,YAAY,CAACC,cAAc,CAAC,QAAQ,EAAEnB,YAAY,CAAC;AAE1D,MAAMoB,OAAO,GAAG,MAAMN,MAAM,CAACI,YAAY,CAACG,MAAM,CAAC,SAAS,CAAC;AAE3DP,MAAM,CAACI,YAAY,CAACI,kBAAkB,CAAC,QAAQ,EAAE,CAACC,OAAO,EAAEC,aAAa,EAAEC,OAAO,KAAK;EACpF,IAAIF,OAAO,CAACG,YAAY,EAAE;IACxB,MAAMC,UAAU,GAAG,CAAC,GAAIJ,OAAO,CAACG,YAAY,GAAGF,aAAa,CAACI,OAAO,GAAG,CAAE;IACzE,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACJ,UAAU,GAAGH,aAAa,CAACI,OAAO,CAAC;IAC9D,OAAO;MACL,GAAGL,OAAO;MACVI,UAAU,EAAEA,UAAU;MACtBE,OAAO,EAAEA;IACX,CAAC;EACH,CAAC,MAAM;IACL,OAAO;MACL,GAAGN;IACL,CAAC;EACH;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAMT,MAAM,CAACkB,KAAK,CAAC,CAAC;;AAEpB"}

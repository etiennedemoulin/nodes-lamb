{"version":3,"names":["Client","launcher","createLayout","html","nothing","keyed","throttle","config","window","SOUNDWORKS_CONFIG","main","$container","client","register","initScreensContainer","reloadOnVisibilityChange","start","$layout","players","stateManager","getCollection","globals","attach","updateVolume","volume","set","master","source","remoteControlledPlayer","addComponent","render","getSchema","min","max","get","e","target","value","map","player","requestUpdate","onAttach","onDetach","execute","numClients","parseInt","URLSearchParams","location","search","width"],"sources":["../../../src/clients/controller/index.js"],"sourcesContent":["import '@soundworks/helpers/polyfills.js';\nimport { Client } from '@soundworks/core/client.js';\nimport launcher from '@soundworks/helpers/launcher.js';\n\nimport createLayout from './layout.js';\n\n\nimport { html, nothing } from 'lit';\nimport { keyed } from 'lit/directives/keyed.js';\nimport '../components/sw-player.js';\nimport '@ircam/sc-components/sc-button.js';\nimport '@ircam/sc-components/sc-slider.js';\nimport throttle from 'lodash/throttle.js'\n\n// import { html } from 'lit';\n\n// - General documentation: https://soundworks.dev/\n// - API documentation:     https://soundworks.dev/api\n// - Issue Tracker:         https://github.com/collective-soundworks/soundworks/issues\n// - Wizard & Tools:        `npx soundworks`\n\nconst config = window.SOUNDWORKS_CONFIG;\n\nasync function main($container) {\n  const client = new Client(config);\n\n  launcher.register(client, {\n    initScreensContainer: $container,\n    reloadOnVisibilityChange: false,\n  });\n\n  await client.start();\n\n  const $layout = createLayout(client, $container);\n\n  // const globals = await client.stateManager.attach('globals');\n  const players = await client.stateManager.getCollection('player');\n  const globals = await client.stateManager.attach('globals');\n\n  const updateVolume = throttle(function (volume) {\n    globals.set({ master: volume}, { source: 'web' });\n  }, 50, { 'trailing' : true});\n\n  // placeholder of the remote controlled player state instance\n  let remoteControlledPlayer = null;\n  // collection\n  $layout.addComponent({\n    render: () => {\n      return html`\n        <div>\n        <h2>Global phones volume</h2>\n        <sc-slider\n          relative\n          orientation=\"vertical\"\n          number-box=\"true\"\n          min=\"${globals.getSchema().master.min}\"\n          max=\"${globals.getSchema().master.max}\"\n          value=${globals.get('master')}\n          @input=${e => updateVolume(e.target.value)}\n        ></sc-slider>\n        </div>\n        <div>\n        <h2>Connected players</h2>\n        ${players.map(player => {\n          return html`\n            <sc-button\n              value=${player.get('id')}\n              @input=${e => {\n                remoteControlledPlayer = player;\n                $layout.requestUpdate();\n              }}\n            ></sc-button>\n          `;\n        })}\n        <h2>Remote controlled player</h2>\n        <div style=\"width:260px; height:420px;\">\n        ${remoteControlledPlayer !== null\n          ? keyed(\n              remoteControlledPlayer.get('id'),\n              html`<sw-player .player=${remoteControlledPlayer}></sw-player>`\n            )\n          : nothing\n        }\n      </div>\n      </div>`;\n    }\n  });\n\n  // if a player connects or disconnect, we want to update the view accordingly\n  players.onAttach(() => $layout.requestUpdate());\n  players.onDetach(player => {\n    // if the player is deleted, we reset the view\n    if (player === remoteControlledPlayer) {\n      remoteControlledPlayer = null;\n    }\n    $layout.requestUpdate();\n  });\n\n  // ...\n  // $layout.addComponent(html`<h1>ok</h1>`);\n\n  // setTimeout(() => {\n  //   console.log($layout.querySelector('h1'));\n  // }, 100);\n}\n\nlauncher.execute(main, {\n  numClients: parseInt(new URLSearchParams(window.location.search).get('emulate')) || 1,\n  width: '50%',\n});\n"],"mappings":"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"}

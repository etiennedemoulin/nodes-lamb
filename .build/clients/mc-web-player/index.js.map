{"version":3,"names":["Client","launcher","pluginPlatformInit","html","createLayout","Engine","config","window","SOUNDWORKS_CONFIG","audioContext","AudioContext","main","$container","client","pluginManager","register","initScreensContainer","start","players","stateManager","getCollection","$layout","destination","channelCount","channelCountMode","channelInterpretation","resume","console","log","merger","createChannelMerger","chArray","engines","Array","fill","onAttach","player","i","length","engine","env","connect","onUpdate","requestUpdate","render","onDetach","get","getEngineId","disconnect","execute","numClients","parseInt","URLSearchParams","location","search"],"sources":["../../../src/clients/mc-web-player/index.js"],"sourcesContent":["import '@soundworks/helpers/polyfills.js';\nimport { Client } from '@soundworks/core/client.js';\nimport launcher from '@soundworks/helpers/launcher.js';\nimport pluginPlatformInit from '@soundworks/plugin-platform-init/client.js';\n\nimport { html } from 'lit';\n\nimport createLayout from './layout.js';\n\nimport '@ircam/sc-components/sc-slider.js';\nimport '@ircam/sc-components/sc-number.js';\nimport '@ircam/sc-components/sc-toggle.js';\nimport '@ircam/sc-components/sc-select.js';\n\nimport '../components/sw-player.js';\n\nimport Engine from '../components/engine.js';\n\n// - General documentation: https://soundworks.dev/\n// - API documentation:     https://soundworks.dev/api\n// - Issue Tracker:         https://github.com/collective-soundworks/soundworks/issues\n// - Wizard & Tools:        `npx soundworks`\n\n/**\n * Grab the configuration object written by the server in the `index.html`\n */\nconst config = window.SOUNDWORKS_CONFIG;\n\nconst audioContext = new AudioContext();\n\n/**\n * If multiple clients are emulated you might to want to share some resources\n */\n// const audioContext = new AudioContext();\n\nasync function main($container) {\n  /**\n   * Create the soundworks client\n   */\n  const client = new Client(config);\n  client.pluginManager.register('platform-init', pluginPlatformInit, { audioContext });\n\n  /**\n   * Register some soundworks plugins, you will need to install the plugins\n   * before hand (run `npx soundworks` for help)\n   */\n  // client.pluginManager.register('my-plugin', plugin);\n\n  /**\n   * Register the soundworks client into the launcher\n   *\n   * The launcher will do a bunch of stuff for you:\n   * - Display default initialization screens. If you want to change the provided\n   * initialization screens, you can import all the helpers directly in your\n   * application by doing `npx soundworks --eject-helpers`. You can also\n   * customise some global syles variables (background-color, text color etc.)\n   * in `src/clients/components/css/app.scss`.\n   * You can also change the default language of the intialization screen by\n   * setting, the `launcher.language` property, e.g.:\n   * `launcher.language = 'fr'`\n   * - By default the launcher automatically reloads the client when the socket\n   * closes or when the page is hidden. Such behavior can be quite important in\n   * performance situation where you don't want some phone getting stuck making\n   * noise without having any way left to stop it... Also be aware that a page\n   * in a background tab will have all its timers (setTimeout, etc.) put in very\n   * low priority, messing any scheduled events.\n   */\n  launcher.register(client, { initScreensContainer: $container });\n\n  /**\n   * Launch application\n   */\n\n  await client.start();\n\n  // const player = await client.stateManager.create('player', {\n  //   id: client.id,\n  // });\n\n  const players = await client.stateManager.getCollection('player');\n\n\n  // The `$layout` is provided as a convenience and is not required by soundworks,\n  // its full source code is located in the `./views/layout.js` file, so feel free\n  // to edit it to match your needs or even to delete it.\n  const $layout = createLayout(client, $container);\n\n  audioContext.destination.channelCount = 16;\n  audioContext.destination.channelCountMode = \"explicit\";\n  audioContext.destination.channelInterpretation = \"discrete\";\n  await audioContext.resume();\n  console.log(audioContext.destination);\n\n  const merger = audioContext.createChannelMerger(16); // 8 in, 1 out\n\n  const chArray = [0, 1, 4, 5, 2, 8, 9, 10]; // slots\n  // 0 : left (1)\n  // 1 : right (2)\n  // 2 : centre (5)\n  // 3 : rien\n  // 4 : left surround (3)\n  // 5 : right surround (4)\n  // 6 : rien\n  // 7 : rien\n  // 8 : centre (6)\n  // 9 : left wide (7)\n  // 10 : right wide (8)\n  const engines = Array(8).fill(null);\n\n  players.onAttach((player) => {\n    // push engine in first free slot\n    for (let i = 0; i < (engines.length - 1); i++) {\n      if (engines[i] === null) {\n        // console.log(`creating engine ${player.get('id')} on slot ${chArray[i]}`)\n        const engine = new Engine(audioContext, player, false);\n        engines[i] = engine;\n        engine.env.connect(merger, 0, chArray[i]);\n        player.onUpdate(() => {\n          $layout.requestUpdate();\n          engine.render();\n        })\n        break;\n      }\n    }\n  });\n\n  players.onDetach((player) => {\n    for (let i = 0; i < (engines.length - 1); i++) {\n      if (engines[i]\n        && player.get('id') === engines[i].getEngineId())\n      {\n        // console.log(`removing engine ${player.get('id')}`)\n        engines[i].env.disconnect();\n        engines[i] = null;\n      }\n    }\n  })\n\n  merger.connect(audioContext.destination);\n\n  // $layout.addComponent(html`<sw-player .player=${player}></sc-player>`);\n\n}\n\n// The launcher enables instanciation of multiple clients in the same page to\n// facilitate development and testing.\n// e.g. `http://127.0.0.1:8000?emulate=10` to run 10 clients side-by-side\nlauncher.execute(main, {\n  numClients: parseInt(new URLSearchParams(window.location.search).get('emulate')) || 1,\n});\n"],"mappings":"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"}

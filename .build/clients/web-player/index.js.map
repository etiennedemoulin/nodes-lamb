{"version":3,"names":["Client","launcher","pluginPlatformInit","html","createLayout","Engine","config","window","SOUNDWORKS_CONFIG","audioContext","AudioContext","main","$container","client","pluginManager","register","initScreensContainer","start","$layout","globals","stateManager","attach","player","create","id","engine","connect","destination","onUpdate","requestUpdate","render","update","addComponent","execute","numClients","parseInt","URLSearchParams","location","search","get"],"sources":["../../../src/clients/web-player/index.js"],"sourcesContent":["import '@soundworks/helpers/polyfills.js';\nimport { Client } from '@soundworks/core/client.js';\nimport launcher from '@soundworks/helpers/launcher.js';\nimport pluginPlatformInit from '@soundworks/plugin-platform-init/client.js';\n\nimport { html } from 'lit';\n\nimport createLayout from './layout.js';\n\nimport '../components/sw-player.js';\n\nimport Engine from '../components/engine.js';\n\n// - General documentation: https://soundworks.dev/\n// - API documentation:     https://soundworks.dev/api\n// - Issue Tracker:         https://github.com/collective-soundworks/soundworks/issues\n// - Wizard & Tools:        `npx soundworks`\n\n/**\n * Grab the configuration object written by the server in the `index.html`\n */\nconst config = window.SOUNDWORKS_CONFIG;\n\nconst audioContext = new AudioContext();\n\n/**\n * If multiple clients are emulated you might to want to share some resources\n */\n// const audioContext = new AudioContext();\n\nasync function main($container) {\n  /**\n   * Create the soundworks client\n   */\n  const client = new Client(config);\n  client.pluginManager.register('platform-init', pluginPlatformInit, { audioContext });\n\n  launcher.register(client, { initScreensContainer: $container });\n\n  /**\n   * Launch application\n   */\n  // console.log(`> before start - audioContext is \"${audioContext.state}\"`);\n  await client.start();\n  // console.log(`> after start - audioContext is \"${audioContext.state}\"`);\n\n  const $layout = createLayout(client, $container);\n\n  const globals = await client.stateManager.attach('globals');\n  const player = await client.stateManager.create('player', {\n    id: client.id,\n  });\n\n  const engine = new Engine(audioContext, player, globals);\n  engine.connect(audioContext.destination);\n\n  player.onUpdate(() => {\n    $layout.requestUpdate();\n    engine.render();\n  });\n\n  globals.onUpdate((update) => {\n    engine.render();\n  });\n\n  $layout.addComponent(html`<sw-player .player=${player}></sc-player>`);\n\n}\n\n// The launcher enables instanciation of multiple clients in the same page to\n// facilitate development and testing.\n// e.g. `http://127.0.0.1:8000?emulate=10` to run 10 clients side-by-side\nlauncher.execute(main, {\n  numClients: parseInt(new URLSearchParams(window.location.search).get('emulate')) || 1,\n});\n"],"mappings":"AAAA,OAAO,kCAAkC;AACzC,SAASA,MAAM,QAAQ,4BAA4B;AACnD,OAAOC,QAAQ,MAAM,iCAAiC;AACtD,OAAOC,kBAAkB,MAAM,4CAA4C;AAE3E,SAASC,IAAI,QAAQ,KAAK;AAE1B,OAAOC,YAAY,MAAM,aAAa;AAEtC,OAAO,4BAA4B;AAEnC,OAAOC,MAAM,MAAM,yBAAyB;;AAE5C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAMC,MAAM,GAAGC,MAAM,CAACC,iBAAiB;AAEvC,MAAMC,YAAY,GAAG,IAAIC,YAAY,CAAC,CAAC;;AAEvC;AACA;AACA;AACA;;AAEA,eAAeC,IAAIA,CAACC,UAAU,EAAE;EAC9B;AACF;AACA;EACE,MAAMC,MAAM,GAAG,IAAIb,MAAM,CAACM,MAAM,CAAC;EACjCO,MAAM,CAACC,aAAa,CAACC,QAAQ,CAAC,eAAe,EAAEb,kBAAkB,EAAE;IAAEO;EAAa,CAAC,CAAC;EAEpFR,QAAQ,CAACc,QAAQ,CAACF,MAAM,EAAE;IAAEG,oBAAoB,EAAEJ;EAAW,CAAC,CAAC;;EAE/D;AACF;AACA;EACE;EACA,MAAMC,MAAM,CAACI,KAAK,CAAC,CAAC;EACpB;;EAEA,MAAMC,OAAO,GAAGd,YAAY,CAACS,MAAM,EAAED,UAAU,CAAC;EAEhD,MAAMO,OAAO,GAAG,MAAMN,MAAM,CAACO,YAAY,CAACC,MAAM,CAAC,SAAS,CAAC;EAC3D,MAAMC,MAAM,GAAG,MAAMT,MAAM,CAACO,YAAY,CAACG,MAAM,CAAC,QAAQ,EAAE;IACxDC,EAAE,EAAEX,MAAM,CAACW;EACb,CAAC,CAAC;EAEF,MAAMC,MAAM,GAAG,IAAIpB,MAAM,CAACI,YAAY,EAAEa,MAAM,EAAEH,OAAO,CAAC;EACxDM,MAAM,CAACC,OAAO,CAACjB,YAAY,CAACkB,WAAW,CAAC;EAExCL,MAAM,CAACM,QAAQ,CAAC,MAAM;IACpBV,OAAO,CAACW,aAAa,CAAC,CAAC;IACvBJ,MAAM,CAACK,MAAM,CAAC,CAAC;EACjB,CAAC,CAAC;EAEFX,OAAO,CAACS,QAAQ,CAAEG,MAAM,IAAK;IAC3BN,MAAM,CAACK,MAAM,CAAC,CAAC;EACjB,CAAC,CAAC;EAEFZ,OAAO,CAACc,YAAY,CAAC7B,IAAK,sBAAqBmB,MAAO,eAAc,CAAC;AAEvE;;AAEA;AACA;AACA;AACArB,QAAQ,CAACgC,OAAO,CAACtB,IAAI,EAAE;EACrBuB,UAAU,EAAEC,QAAQ,CAAC,IAAIC,eAAe,CAAC7B,MAAM,CAAC8B,QAAQ,CAACC,MAAM,CAAC,CAACC,GAAG,CAAC,SAAS,CAAC,CAAC,IAAI;AACtF,CAAC,CAAC"}

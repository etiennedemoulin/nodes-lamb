{"version":3,"names":["Engine","constructor","audioContext","player","volumeFlag","now","currentTime","saw","createOscillator","env","createGain","filter","createBiquadFilter","gain","setValueAtTime","type","Q","value","frequency","connect","start","render","filterFreq","computeFilterValues","linearRampToValueAtTime","get","Number","sliderValue","sawFreq","Math","max","numHarm","floor","set","source","getEngineId","destination","outlet","inlet","disconnect"],"sources":["../../../src/clients/components/engine.js"],"sourcesContent":["export default class Engine {\n  constructor(audioContext, player, volumeFlag = true) {\n    this.audioContext = audioContext;\n    this.player = player;\n\n    this.volumeFlag = volumeFlag;\n\n    const now = this.audioContext.currentTime;\n    this.saw = this.audioContext.createOscillator();\n    this.env = this.audioContext.createGain();\n    this.filter = this.audioContext.createBiquadFilter();\n    this.env.gain.setValueAtTime(0, now);\n    this.saw.type = 'sawtooth';\n    this.filter.Q.value = 11;\n    this.filter.type = \"lowpass\";\n    this.filter.frequency.setValueAtTime(10, now + 0.1);\n    this.saw.connect(this.filter);\n    this.filter.connect(this.env);\n    this.saw.start(now);\n  }\n\n  render() {\n    // hook from engine !\n    const filterFreq = this.computeFilterValues();\n\n    // sonify\n    const now = this.audioContext.currentTime;\n    if (this.volumeFlag === true) {\n      this.env.gain.linearRampToValueAtTime(this.player.get('volume'), now + 0.1);\n    } else {\n      this.env.gain.linearRampToValueAtTime(0.1, now + 0.1);\n    }\n    this.saw.frequency.value = Number(this.player.get('sawFreq'));\n    this.filter.frequency.linearRampToValueAtTime(filterFreq, now + 0.1);\n  }\n\n  computeFilterValues() {\n    const sliderValue = this.player.get('filterSlider');\n    const sawFreq = this.player.get('sawFreq');\n    const filterFreq = Math.max((sliderValue * sawFreq) * 7, 10);\n    const numHarm = Math.floor(filterFreq / sawFreq);\n    this.player.set({ filterFreq: filterFreq, numHarm: numHarm}, { source: 'engine' });\n    return filterFreq;\n  }\n\n  getEngineId() {\n    return this.player.get('id');\n  }\n\n  connect(destination, outlet, inlet) {\n    this.env.connect(destination, outlet, inlet);\n  }\n\n  disconnect() {\n    this.env.disconnect();\n  }\n}\n"],"mappings":"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"}

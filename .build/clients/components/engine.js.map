{"version":3,"names":["Engine","constructor","audioContext","player","globals","volumeFlag","now","currentTime","master","createGain","gain","setValueAtTime","getSchema","max","env","connect","filter","createBiquadFilter","Q","value","type","frequency","saw","createOscillator","start","render","filterFreq","updateFilterSlider","Number","get","linearRampToValueAtTime","filterSlider","sawFreq","Math","floor","numHarm","set","source","getEngineId","destination","outlet","inlet","disconnect"],"sources":["../../../src/clients/components/engine.js"],"sourcesContent":["export default class Engine {\n  constructor(audioContext, player, globals, volumeFlag) {\n    this.audioContext = audioContext;\n    this.player = player;\n    this.globals = globals\n\n    const now = this.audioContext.currentTime;\n\n    this.volumeFlag = volumeFlag;\n\n    this.master = this.audioContext.createGain();\n    this.master.gain.setValueAtTime(this.globals.getSchema().master.max, now);\n\n    this.env = this.audioContext.createGain();\n    this.env.gain.setValueAtTime(0, now);\n    this.env.connect(this.master);\n\n    this.filter = this.audioContext.createBiquadFilter();\n    this.filter.Q.value = 11;\n    this.filter.type = \"lowpass\";\n    this.filter.frequency.setValueAtTime(10, now + 0.1);\n    this.filter.connect(this.env);\n\n    this.saw = this.audioContext.createOscillator();\n    this.saw.type = 'sawtooth';\n    this.saw.connect(this.filter);\n    this.saw.start(now);\n  }\n\n  render() {\n    // sonify\n    const now = this.audioContext.currentTime;\n    const filterFreq = this.updateFilterSlider();\n\n    this.saw.frequency.value = Number(this.player.get('sawFreq'));\n    this.filter.frequency.linearRampToValueAtTime(filterFreq, now + 0.1);\n    this.env.gain.linearRampToValueAtTime(this.player.get('volume'), now + 0.1);\n    if (this.volumeFlag === true) {\n      // phones\n      this.master.gain.linearRampToValueAtTime(this.globals.get('master'), now + 0.1);\n    } else {\n      // node\n      this.master.gain.setValueAtTime(1, now + 0.1);\n    }\n  }\n\n  updateFilterSlider() {\n      const filterSlider = this.player.get('filterSlider');\n      const sawFreq = this.player.get('sawFreq');\n      const filterFreq = Math.floor(Math.max((filterSlider * sawFreq) * 7, 10));\n      const numHarm = Math.floor(filterFreq / sawFreq);\n      this.player.set({ filterFreq: filterFreq, numHarm: numHarm, filterSlider: filterSlider }, { source: 'engine' });\n      return filterFreq;\n  }\n\n  getEngineId() {\n    return this.player.get('id');\n  }\n\n  connect(destination, outlet, inlet) {\n    this.master.connect(destination, outlet, inlet);\n  }\n\n  disconnect() {\n    this.master.disconnect();\n  }\n}\n"],"mappings":"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"}

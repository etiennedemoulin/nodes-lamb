{"version":3,"names":["Engine","constructor","audioContext","player","globals","volumeFlag","now","currentTime","env","createGain","gain","setValueAtTime","filter","createBiquadFilter","Q","value","type","frequency","connect","saw","createOscillator","start","render","linearRampToValueAtTime","get","maxVolume","getSchema","volume","max","Number","updateVolume","getEngineId","destination","outlet","inlet","disconnect"],"sources":["../../../src/clients/components/engine.js"],"sourcesContent":["export default class Engine {\n  constructor(audioContext, player, globals, volumeFlag) {\n    this.audioContext = audioContext;\n    this.player = player;\n    this.globals = globals\n\n    this.volumeFlag = volumeFlag;\n\n    const now = this.audioContext.currentTime;\n    this.env = this.audioContext.createGain();\n    this.env.gain.setValueAtTime(0, now);\n\n    this.filter = this.audioContext.createBiquadFilter();\n    this.filter.Q.value = 11;\n    this.filter.type = \"lowpass\";\n    this.filter.frequency.setValueAtTime(10, now + 0.1);\n    this.filter.connect(this.env);\n\n    this.saw = this.audioContext.createOscillator();\n    this.saw.type = 'sawtooth';\n    this.saw.connect(this.filter);\n    this.saw.start(now);\n  }\n\n  render() {\n    // sonify\n    const now = this.audioContext.currentTime;\n\n    if (this.volumeFlag) {\n      // we want gain control\n      this.env.gain.linearRampToValueAtTime(this.globals.get('volume'), now + 0.1);\n    } else {\n      // we dont want gain control\n      const maxVolume = this.globals.getSchema().volume.max;\n      this.env.gain.linearRampToValueAtTime(maxVolume, now + 0.1);\n    }\n\n    this.saw.frequency.value = Number(this.player.get('sawFreq'));\n    this.filter.frequency.linearRampToValueAtTime(this.player.get('filterFreq'), now + 0.1);\n  }\n\n  updateVolume(gain) {\n    const now = this.audioContext.currentTime;\n    this.env.gain.linearRampToValueAtTime(gain, now + 0.1);\n  }\n\n  getEngineId() {\n    return this.player.get('id');\n  }\n\n  connect(destination, outlet, inlet) {\n    this.env.connect(destination, outlet, inlet);\n  }\n\n  disconnect() {\n    this.env.disconnect();\n  }\n}\n"],"mappings":"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"}
